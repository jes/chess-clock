<!doctype html>
<html>
<head>
<title>Chess Clock</title>
<link rel="stylesheet" type="text/css" href="css/chessboard-0.3.0.min.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="container">
<h1>Chess Clock</h1>

<div style="float:left; border-right:solid 1px #ccc; padding-right:5px; margin-right:20px; padding-bottom:20px">
<span style="font-size:1.2em; font-weight:bold" id="hms"></span>
<div id="board" style="width:500px"></div>
<span id="san"></span><br>
(next <span id="move"></span> in <span style="font-weight: bold" id="nextmove"></span> <span id="seconds"></span>)
</div>

<div>
<p>This chess board is a clock. Each position uniquely encodes the time of day, to the nearest 10 seconds.</p>

<p>The game is a 4320-move marathon, ending at 23:59:50, and resetting to the starting position at 00:00:00
to repeat the game the next day. It's a completely legal game. Some of the moves are pretty bad though.</p>

<p>(Check out the <a href="converter.html">Chess Clock Time Converter</a> if you want to convert between ordinary time and Chess Clock time).</p>

<p><h4>That's too many moves for a chess game</h4>
Most chess games aren't this long because the players deliberately end it. Both players here deliberately <i>avoid</i> ending the game until the
4320th move.
</p>

<p><h4>What about draw by threefold repetition?</h4>
If there were even twofold repetition, the board position would no longer uniquely encode each possible timestamp, so the players make
sure they never repeat any position.</p>

<p><h4>But what about the 50-move rule?</h4>
The 50-move rule allows a player to <i>claim</i> a draw if the last 50 consecutive moves have been made by each player without the movement of any pawn and
without the capture of any piece. Since both players want the game to continue, neither player claims a draw.</p>

<p><h4>OK, what about the 75-move rule?</h4>
After 75 consecutive moves without the movement of any pawn and without the capture of any piece, the game is drawn unless the last move was checkmate.
To avoid this, they play exactly one pawn move or piece capture every 74th move, except in the opening where each player moves a pawn, and in the very
closing stages where they make extra pawn moves and piece captures because they don't care any more.</p>
</div>

<div style="clear:both"></div>
<hr>
<p>By <a href="https://incoherency.co.uk/">James Stanley</a>.</p>

</div>

<script src="js/jquery-3.4.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/chessboard-0.3.0.min.js"></script>
<script src="js/fens.js"></script>
<script src="js/sans.js"></script>
<script type="text/javascript">
    let board = ChessBoard('board', 'start');
    function redraw(use_anim) {
        let now = new Date();
        let hour = now.getHours();
        let min = now.getMinutes();
        let sec = now.getSeconds();
        let secsinday = hour*3600 + min*60 + sec;
        let boardposition = Math.floor(secsinday/10) % clock_fens.length;
        board.position(clock_fens[boardposition], use_anim);

        $('#hms').text(pad(hour,2) + ":" + pad(min,2) + ":" + Math.floor(sec/10) + "0");
        let secondsleft = 10 - (sec%10);
        $('#nextmove').text(secondsleft);
        $('#seconds').text("second" + (secondsleft == 1 ? '' : 's'));
        $('#move').text(boardposition == 8639 ? 'game' : 'move');

        let pgn = '';
        let startsan = 1;
        let endsan = boardposition;
        let showmoves = 7;
        if (endsan > showmoves+1) {
            startsan = endsan - showmoves;
            pgn = '[...] ';
        }
        if (startsan % 2 == 0) // always start with a white move
            startsan++;
        for (let i = startsan; i <= endsan; i++) {
            if (i % 2 == 1) { // move number before white move
                pgn += Math.ceil(i/2) + ". ";
            }
            pgn += clock_sans[i] + " ";
        }
        $('#san').text(pgn);
    }
    redraw(false);
    window.setInterval(function() { redraw(true) }, 1000);

    // https://stackoverflow.com/a/10073788
    function pad(n, width, z) {
      z = z || '0';
      n = n + '';
      return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
    }
</script>
</body>
</html>
